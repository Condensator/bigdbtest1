SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE PROC [dbo].[SaveLeaseFinanceDetail]
(
 @val [dbo].[LeaseFinanceDetail] READONLY
)
AS
SET NOCOUNT ON;
DECLARE @Output TABLE(
 [Action] NVARCHAR(10) NOT NULL,
 [Id] bigint NOT NULL,
 [Token] int NOT NULL,
 [RowVersion] BIGINT,
 [OldRowVersion] BIGINT
)
MERGE [dbo].[LeaseFinanceDetails] With (ForceSeek) AS T
USING (SELECT * FROM @val) AS S
		ON ( T.Id = S.Id)
WHEN MATCHED THEN
	UPDATE SET [AdvancetoDealer_Amount]=S.[AdvancetoDealer_Amount],[AdvancetoDealer_Currency]=S.[AdvancetoDealer_Currency],[ApprovalDateSwapRate]=S.[ApprovalDateSwapRate],[ApprovalNumber]=S.[ApprovalNumber],[BankYieldSpread]=S.[BankYieldSpread],[BillInterimAsOf]=S.[BillInterimAsOf],[BillOTPForSoftAssets]=S.[BillOTPForSoftAssets],[BookedResidual_Amount]=S.[BookedResidual_Amount],[BookedResidual_Currency]=S.[BookedResidual_Currency],[CapitalizedSalesTaxPayment_Amount]=S.[CapitalizedSalesTaxPayment_Amount],[CapitalizedSalesTaxPayment_Currency]=S.[CapitalizedSalesTaxPayment_Currency],[CapitalizeUpfrontSalesTax]=S.[CapitalizeUpfrontSalesTax],[CashGuaranteesAmount_Amount]=S.[CashGuaranteesAmount_Amount],[CashGuaranteesAmount_Currency]=S.[CashGuaranteesAmount_Currency],[ClassificationContractType]=S.[ClassificationContractType],[ClassificationOverriddenById]=S.[ClassificationOverriddenById],[ClassificationYield]=S.[ClassificationYield],[ClassificationYield5A]=S.[ClassificationYield5A],[ClassificationYield5B]=S.[ClassificationYield5B],[CommencementDate]=S.[CommencementDate],[CompoundingFrequency]=S.[CompoundingFrequency],[CostOfFunds]=S.[CostOfFunds],[CreateInvoiceForAdvanceRental]=S.[CreateInvoiceForAdvanceRental],[CreateSoftAssetsForCappedSalesTax]=S.[CreateSoftAssetsForCappedSalesTax],[CreateSoftAssetsForInterimInterest]=S.[CreateSoftAssetsForInterimInterest],[CreateSoftAssetsForInterimRent]=S.[CreateSoftAssetsForInterimRent],[CustomerExpectedResidual_Amount]=S.[CustomerExpectedResidual_Amount],[CustomerExpectedResidual_Currency]=S.[CustomerExpectedResidual_Currency],[CustomerFacingYield]=S.[CustomerFacingYield],[CustomerGuaranteedResidual_Amount]=S.[CustomerGuaranteedResidual_Amount],[CustomerGuaranteedResidual_Currency]=S.[CustomerGuaranteedResidual_Currency],[CustomerNotificationLeadDays]=S.[CustomerNotificationLeadDays],[CustomerTermInMonths]=S.[CustomerTermInMonths],[DateOfIncorporation]=S.[DateOfIncorporation],[DayCountConvention]=S.[DayCountConvention],[DeferredSellingProfit_Amount]=S.[DeferredSellingProfit_Amount],[DeferredSellingProfit_Currency]=S.[DeferredSellingProfit_Currency],[DeferredTaxBalance_Amount]=S.[DeferredTaxBalance_Amount],[DeferredTaxBalance_Currency]=S.[DeferredTaxBalance_Currency],[DeferredTaxGLTemplateId]=S.[DeferredTaxGLTemplateId],[DeliverViaEmail]=S.[DeliverViaEmail],[DeliverViaMail]=S.[DeliverViaMail],[DownPayment_Amount]=S.[DownPayment_Amount],[DownPayment_Currency]=S.[DownPayment_Currency],[DownPaymentDueDate]=S.[DownPaymentDueDate],[DownPaymentPercentageId]=S.[DownPaymentPercentageId],[DueDay]=S.[DueDay],[EffectiveAnnualRate]=S.[EffectiveAnnualRate],[EligibleForResidualValueInsurance]=S.[EligibleForResidualValueInsurance],[ExpirationDate]=S.[ExpirationDate],[FinancedAmountExclVAT_Amount]=S.[FinancedAmountExclVAT_Amount],[FinancedAmountExclVAT_Currency]=S.[FinancedAmountExclVAT_Currency],[FixedTermReceivableCodeId]=S.[FixedTermReceivableCodeId],[FloatIncomeGLTemplateId]=S.[FloatIncomeGLTemplateId],[FloatRateARReceivableCodeId]=S.[FloatRateARReceivableCodeId],[FloridaStampTax_Amount]=S.[FloridaStampTax_Amount],[FloridaStampTax_Currency]=S.[FloridaStampTax_Currency],[FMV_Amount]=S.[FMV_Amount],[FMV_Currency]=S.[FMV_Currency],[FollowUpLeadDays]=S.[FollowUpLeadDays],[FrequencyStartDate]=S.[FrequencyStartDate],[GLJournalId]=S.[GLJournalId],[InceptionPayment_Amount]=S.[InceptionPayment_Amount],[InceptionPayment_Currency]=S.[InceptionPayment_Currency],[InterimAssessmentMethod]=S.[InterimAssessmentMethod],[InterimInterestBillingType]=S.[InterimInterestBillingType],[InterimInterestDayCountConvention]=S.[InterimInterestDayCountConvention],[InterimInterestFrequencyStartDate]=S.[InterimInterestFrequencyStartDate],[InterimInterestIncomeGLTemplateId]=S.[InterimInterestIncomeGLTemplateId],[InterimInterestReceivableCodeId]=S.[InterimInterestReceivableCodeId],[InterimPaymentFrequency]=S.[InterimPaymentFrequency],[InterimPaymentFrequencyDays]=S.[InterimPaymentFrequencyDays],[InterimRent_Amount]=S.[InterimRent_Amount],[InterimRent_Currency]=S.[InterimRent_Currency],[InterimRentBillingType]=S.[InterimRentBillingType],[InterimRentDayCountConvention]=S.[InterimRentDayCountConvention],[InterimRentFrequencyStartDate]=S.[InterimRentFrequencyStartDate],[InterimRentIncomeGLTemplateId]=S.[InterimRentIncomeGLTemplateId],[InterimRentPayableCodeId]=S.[InterimRentPayableCodeId],[InterimRentPayableWithholdingTaxRate]=S.[InterimRentPayableWithholdingTaxRate],[InterimRentReceivableCodeId]=S.[InterimRentReceivableCodeId],[InternalYield]=S.[InternalYield],[InvestmentModifiedAfterPayment]=S.[InvestmentModifiedAfterPayment],[InvestmentModifiedAfterPaymentForSpecificCostAdj]=S.[InvestmentModifiedAfterPaymentForSpecificCostAdj],[InvestorNotificationLeadDays]=S.[InvestorNotificationLeadDays],[IsAdvance]=S.[IsAdvance],[IsApplicable]=S.[IsApplicable],[IsBargainPurchaseOption]=S.[IsBargainPurchaseOption],[IsBuybackGuaranteebyVendor]=S.[IsBuybackGuaranteebyVendor],[IsCalculationDoneAsOfSalesType]=S.[IsCalculationDoneAsOfSalesType],[IsClassificationTestDone]=S.[IsClassificationTestDone],[IsClassificationYield5AExtreme]=S.[IsClassificationYield5AExtreme],[IsClassificationYield5BExtreme]=S.[IsClassificationYield5BExtreme],[IsClassificationYieldExtreme]=S.[IsClassificationYieldExtreme],[IsDownpaymentIncludesTax]=S.[IsDownpaymentIncludesTax],[IsFloatRateLease]=S.[IsFloatRateLease],[IsInterimRentInAdvance]=S.[IsInterimRentInAdvance],[IsInternalYieldExtreme]=S.[IsInternalYieldExtreme],[IsLesseeNotice]=S.[IsLesseeNotice],[IsLessorNotice]=S.[IsLessorNotice],[IsLessorYieldExtreme]=S.[IsLessorYieldExtreme],[IsLessorYieldFinanceAssetExtreme]=S.[IsLessorYieldFinanceAssetExtreme],[IsLessorYieldLeaseAssetExtreme]=S.[IsLessorYieldLeaseAssetExtreme],[IsManagementYieldComputed]=S.[IsManagementYieldComputed],[IsManagementYieldExtreme]=S.[IsManagementYieldExtreme],[IsOTPParametersChanged]=S.[IsOTPParametersChanged],[IsOTPRegularPaymentStream]=S.[IsOTPRegularPaymentStream],[IsOTPScheduled]=S.[IsOTPScheduled],[IsOverTermLease]=S.[IsOverTermLease],[IsPricingYieldExtreme]=S.[IsPricingYieldExtreme],[IsPromissoryNote]=S.[IsPromissoryNote],[IsRegularPaymentStream]=S.[IsRegularPaymentStream],[IsReleased]=S.[IsReleased],[IsSpecializedUseAssets]=S.[IsSpecializedUseAssets],[IsStepPayment]=S.[IsStepPayment],[IsSupplementalAdvance]=S.[IsSupplementalAdvance],[IsTaxLease]=S.[IsTaxLease],[IsTotalYieldExtreme]=S.[IsTotalYieldExtreme],[IsTransferOfOwnership]=S.[IsTransferOfOwnership],[IsYieldComputed]=S.[IsYieldComputed],[LastExtensionARUpdateRunDate]=S.[LastExtensionARUpdateRunDate],[LastSupplementalARUpdateRunDate]=S.[LastSupplementalARUpdateRunDate],[LeaseBookingGLTemplateId]=S.[LeaseBookingGLTemplateId],[LeaseContractType]=S.[LeaseContractType],[LeaseIncomeGLTemplateId]=S.[LeaseIncomeGLTemplateId],[LessorNoticePeriod]=S.[LessorNoticePeriod],[LessorYield]=S.[LessorYield],[LessorYieldFinanceAsset]=S.[LessorYieldFinanceAsset],[LessorYieldLeaseAsset]=S.[LessorYieldLeaseAsset],[ManagementYield]=S.[ManagementYield],[Markup_Amount]=S.[Markup_Amount],[Markup_Currency]=S.[Markup_Currency],[MaturityDate]=S.[MaturityDate],[MaturityDateBasis]=S.[MaturityDateBasis],[MaturityPayment_Amount]=S.[MaturityPayment_Amount],[MaturityPayment_Currency]=S.[MaturityPayment_Currency],[MaxNoticePeriod]=S.[MaxNoticePeriod],[MinNoticePeriod]=S.[MinNoticePeriod],[NetInvestment_Amount]=S.[NetInvestment_Amount],[NetInvestment_Currency]=S.[NetInvestment_Currency],[NetTermBasis]=S.[NetTermBasis],[NetTerms]=S.[NetTerms],[NinetyPercent5ATestResult]=S.[NinetyPercent5ATestResult],[NinetyPercent5ATestResultPassed]=S.[NinetyPercent5ATestResultPassed],[NinetyPercent5BTestResult]=S.[NinetyPercent5BTestResult],[NinetyPercent5BTestResultPassed]=S.[NinetyPercent5BTestResultPassed],[NinetyPercentTestPresentValue_Amount]=S.[NinetyPercentTestPresentValue_Amount],[NinetyPercentTestPresentValue_Currency]=S.[NinetyPercentTestPresentValue_Currency],[NinetyPercentTestPresentValue5A_Amount]=S.[NinetyPercentTestPresentValue5A_Amount],[NinetyPercentTestPresentValue5A_Currency]=S.[NinetyPercentTestPresentValue5A_Currency],[NinetyPercentTestPresentValue5B_Amount]=S.[NinetyPercentTestPresentValue5B_Amount],[NinetyPercentTestPresentValue5B_Currency]=S.[NinetyPercentTestPresentValue5B_Currency],[NinetyPercentTestResult]=S.[NinetyPercentTestResult],[NinetyPercentTestResultPassed]=S.[NinetyPercentTestResultPassed],[NoticeBasis]=S.[NoticeBasis],[NumberOfInceptionPayments]=S.[NumberOfInceptionPayments],[NumberOfOverTermPayments]=S.[NumberOfOverTermPayments],[NumberOfPayments]=S.[NumberOfPayments],[OfferLetterAdditionalDays]=S.[OfferLetterAdditionalDays],[OTPIncomeGLTemplateId]=S.[OTPIncomeGLTemplateId],[OTPPaymentFrequency]=S.[OTPPaymentFrequency],[OTPPaymentFrequencyUnit]=S.[OTPPaymentFrequencyUnit],[OTPReceivableCodeId]=S.[OTPReceivableCodeId],[OTPRent_Amount]=S.[OTPRent_Amount],[OTPRent_Currency]=S.[OTPRent_Currency],[OTPRentPayableCodeId]=S.[OTPRentPayableCodeId],[OTPRentPayableWithholdingTaxRate]=S.[OTPRentPayableWithholdingTaxRate],[OTPRentPreference]=S.[OTPRentPreference],[OTPSharingTemplateId]=S.[OTPSharingTemplateId],[OverrideReason]=S.[OverrideReason],[PaymentFrequency]=S.[PaymentFrequency],[PaymentFrequencyDays]=S.[PaymentFrequencyDays],[PercentageToVendor]=S.[PercentageToVendor],[PostDate]=S.[PostDate],[PreRVINinetyPercentTestPresentValue_Amount]=S.[PreRVINinetyPercentTestPresentValue_Amount],[PreRVINinetyPercentTestPresentValue_Currency]=S.[PreRVINinetyPercentTestPresentValue_Currency],[PreRVINinetyPercentTestResult]=S.[PreRVINinetyPercentTestResult],[ProfitLossStatus]=S.[ProfitLossStatus],[PromissoryNote_Amount]=S.[PromissoryNote_Amount],[PromissoryNote_Currency]=S.[PromissoryNote_Currency],[PropertyTaxReceivableCodeId]=S.[PropertyTaxReceivableCodeId],[PurchaseOption]=S.[PurchaseOption],[PurchaseRVIForCapitalLeaseTreatment]=S.[PurchaseRVIForCapitalLeaseTreatment],[RateCardRate]=S.[RateCardRate],[RateExpirationDate]=S.[RateExpirationDate],[RecalculateInterestonReprice]=S.[RecalculateInterestonReprice],[RegularPaymentAmount_Amount]=S.[RegularPaymentAmount_Amount],[RegularPaymentAmount_Currency]=S.[RegularPaymentAmount_Currency],[RemainingEconomicLifeInMonths]=S.[RemainingEconomicLifeInMonths],[RemarketingResponsibility]=S.[RemarketingResponsibility],[Rent_Amount]=S.[Rent_Amount],[Rent_Currency]=S.[Rent_Currency],[RentAccrualDate]=S.[RentAccrualDate],[ResidualValueInsurance_Amount]=S.[ResidualValueInsurance_Amount],[ResidualValueInsurance_Currency]=S.[ResidualValueInsurance_Currency],[RestructureOnFloatRateChange]=S.[RestructureOnFloatRateChange],[SalesTypeLeaseGrossProfit_Amount]=S.[SalesTypeLeaseGrossProfit_Amount],[SalesTypeLeaseGrossProfit_Currency]=S.[SalesTypeLeaseGrossProfit_Currency],[SendCCEmailNotificationTo]=S.[SendCCEmailNotificationTo],[SendEmailNotificationTo]=S.[SendEmailNotificationTo],[StepPaymentStartDate]=S.[StepPaymentStartDate],[StepPercentage]=S.[StepPercentage],[StepPeriod]=S.[StepPeriod],[StubAdjustment]=S.[StubAdjustment],[SupplementalFrequency]=S.[SupplementalFrequency],[SupplementalFrequencyUnit]=S.[SupplementalFrequencyUnit],[SupplementalGracePeriod]=S.[SupplementalGracePeriod],[SupplementalReceivableCodeId]=S.[SupplementalReceivableCodeId],[SupplementalRent_Amount]=S.[SupplementalRent_Amount],[SupplementalRent_Currency]=S.[SupplementalRent_Currency],[TaxAssetSetupGLTemplateId]=S.[TaxAssetSetupGLTemplateId],[TaxDepDisposalTemplateId]=S.[TaxDepDisposalTemplateId],[TaxDepExpenseGLTemplateId]=S.[TaxDepExpenseGLTemplateId],[TennesseeIndebtednessTax_Amount]=S.[TennesseeIndebtednessTax_Amount],[TennesseeIndebtednessTax_Currency]=S.[TennesseeIndebtednessTax_Currency],[TerminationNoticeEffectiveDate]=S.[TerminationNoticeEffectiveDate],[TerminationNoticeReceived]=S.[TerminationNoticeReceived],[TerminationNoticeReceivedOn]=S.[TerminationNoticeReceivedOn],[TermInMonths]=S.[TermInMonths],[ThirdPartyGuaranteedResidual_Amount]=S.[ThirdPartyGuaranteedResidual_Amount],[ThirdPartyGuaranteedResidual_Currency]=S.[ThirdPartyGuaranteedResidual_Currency],[TNIndebtednessDiligenzFee_Amount]=S.[TNIndebtednessDiligenzFee_Amount],[TNIndebtednessDiligenzFee_Currency]=S.[TNIndebtednessDiligenzFee_Currency],[TotalDownPayment_Amount]=S.[TotalDownPayment_Amount],[TotalDownPayment_Currency]=S.[TotalDownPayment_Currency],[TotalEconomicLifeInMonths]=S.[TotalEconomicLifeInMonths],[TotalEconomicLifeTestResult]=S.[TotalEconomicLifeTestResult],[TotalStreamTaxAmount_Amount]=S.[TotalStreamTaxAmount_Amount],[TotalStreamTaxAmount_Currency]=S.[TotalStreamTaxAmount_Currency],[TotalUpfrontTaxAmount_Amount]=S.[TotalUpfrontTaxAmount_Amount],[TotalUpfrontTaxAmount_Currency]=S.[TotalUpfrontTaxAmount_Currency],[TotalYield]=S.[TotalYield],[UpdatedById]=S.[UpdatedById],[UpdatedTime]=S.[UpdatedTime],[VATDownPayment_Amount]=S.[VATDownPayment_Amount],[VATDownPayment_Currency]=S.[VATDownPayment_Currency],[VendorExceptionApprovalNumber]=S.[VendorExceptionApprovalNumber],[VendorRateBuyDownAmount_Amount]=S.[VendorRateBuyDownAmount_Amount],[VendorRateBuyDownAmount_Currency]=S.[VendorRateBuyDownAmount_Currency],[YieldCalculationParametersChanged]=S.[YieldCalculationParametersChanged]
WHEN NOT MATCHED THEN
	INSERT ([AdvancetoDealer_Amount],[AdvancetoDealer_Currency],[ApprovalDateSwapRate],[ApprovalNumber],[BankYieldSpread],[BillInterimAsOf],[BillOTPForSoftAssets],[BookedResidual_Amount],[BookedResidual_Currency],[CapitalizedSalesTaxPayment_Amount],[CapitalizedSalesTaxPayment_Currency],[CapitalizeUpfrontSalesTax],[CashGuaranteesAmount_Amount],[CashGuaranteesAmount_Currency],[ClassificationContractType],[ClassificationOverriddenById],[ClassificationYield],[ClassificationYield5A],[ClassificationYield5B],[CommencementDate],[CompoundingFrequency],[CostOfFunds],[CreatedById],[CreatedTime],[CreateInvoiceForAdvanceRental],[CreateSoftAssetsForCappedSalesTax],[CreateSoftAssetsForInterimInterest],[CreateSoftAssetsForInterimRent],[CustomerExpectedResidual_Amount],[CustomerExpectedResidual_Currency],[CustomerFacingYield],[CustomerGuaranteedResidual_Amount],[CustomerGuaranteedResidual_Currency],[CustomerNotificationLeadDays],[CustomerTermInMonths],[DateOfIncorporation],[DayCountConvention],[DeferredSellingProfit_Amount],[DeferredSellingProfit_Currency],[DeferredTaxBalance_Amount],[DeferredTaxBalance_Currency],[DeferredTaxGLTemplateId],[DeliverViaEmail],[DeliverViaMail],[DownPayment_Amount],[DownPayment_Currency],[DownPaymentDueDate],[DownPaymentPercentageId],[DueDay],[EffectiveAnnualRate],[EligibleForResidualValueInsurance],[ExpirationDate],[FinancedAmountExclVAT_Amount],[FinancedAmountExclVAT_Currency],[FixedTermReceivableCodeId],[FloatIncomeGLTemplateId],[FloatRateARReceivableCodeId],[FloridaStampTax_Amount],[FloridaStampTax_Currency],[FMV_Amount],[FMV_Currency],[FollowUpLeadDays],[FrequencyStartDate],[GLJournalId],[Id],[InceptionPayment_Amount],[InceptionPayment_Currency],[InterimAssessmentMethod],[InterimInterestBillingType],[InterimInterestDayCountConvention],[InterimInterestFrequencyStartDate],[InterimInterestIncomeGLTemplateId],[InterimInterestReceivableCodeId],[InterimPaymentFrequency],[InterimPaymentFrequencyDays],[InterimRent_Amount],[InterimRent_Currency],[InterimRentBillingType],[InterimRentDayCountConvention],[InterimRentFrequencyStartDate],[InterimRentIncomeGLTemplateId],[InterimRentPayableCodeId],[InterimRentPayableWithholdingTaxRate],[InterimRentReceivableCodeId],[InternalYield],[InvestmentModifiedAfterPayment],[InvestmentModifiedAfterPaymentForSpecificCostAdj],[InvestorNotificationLeadDays],[IsAdvance],[IsApplicable],[IsBargainPurchaseOption],[IsBuybackGuaranteebyVendor],[IsCalculationDoneAsOfSalesType],[IsClassificationTestDone],[IsClassificationYield5AExtreme],[IsClassificationYield5BExtreme],[IsClassificationYieldExtreme],[IsDownpaymentIncludesTax],[IsFloatRateLease],[IsInterimRentInAdvance],[IsInternalYieldExtreme],[IsLesseeNotice],[IsLessorNotice],[IsLessorYieldExtreme],[IsLessorYieldFinanceAssetExtreme],[IsLessorYieldLeaseAssetExtreme],[IsManagementYieldComputed],[IsManagementYieldExtreme],[IsOTPParametersChanged],[IsOTPRegularPaymentStream],[IsOTPScheduled],[IsOverTermLease],[IsPricingYieldExtreme],[IsPromissoryNote],[IsRegularPaymentStream],[IsReleased],[IsSpecializedUseAssets],[IsStepPayment],[IsSupplementalAdvance],[IsTaxLease],[IsTotalYieldExtreme],[IsTransferOfOwnership],[IsYieldComputed],[LastExtensionARUpdateRunDate],[LastSupplementalARUpdateRunDate],[LeaseBookingGLTemplateId],[LeaseContractType],[LeaseIncomeGLTemplateId],[LessorNoticePeriod],[LessorYield],[LessorYieldFinanceAsset],[LessorYieldLeaseAsset],[ManagementYield],[Markup_Amount],[Markup_Currency],[MaturityDate],[MaturityDateBasis],[MaturityPayment_Amount],[MaturityPayment_Currency],[MaxNoticePeriod],[MinNoticePeriod],[NetInvestment_Amount],[NetInvestment_Currency],[NetTermBasis],[NetTerms],[NinetyPercent5ATestResult],[NinetyPercent5ATestResultPassed],[NinetyPercent5BTestResult],[NinetyPercent5BTestResultPassed],[NinetyPercentTestPresentValue_Amount],[NinetyPercentTestPresentValue_Currency],[NinetyPercentTestPresentValue5A_Amount],[NinetyPercentTestPresentValue5A_Currency],[NinetyPercentTestPresentValue5B_Amount],[NinetyPercentTestPresentValue5B_Currency],[NinetyPercentTestResult],[NinetyPercentTestResultPassed],[NoticeBasis],[NumberOfInceptionPayments],[NumberOfOverTermPayments],[NumberOfPayments],[OfferLetterAdditionalDays],[OTPIncomeGLTemplateId],[OTPPaymentFrequency],[OTPPaymentFrequencyUnit],[OTPReceivableCodeId],[OTPRent_Amount],[OTPRent_Currency],[OTPRentPayableCodeId],[OTPRentPayableWithholdingTaxRate],[OTPRentPreference],[OTPSharingTemplateId],[OverrideReason],[PaymentFrequency],[PaymentFrequencyDays],[PercentageToVendor],[PostDate],[PreRVINinetyPercentTestPresentValue_Amount],[PreRVINinetyPercentTestPresentValue_Currency],[PreRVINinetyPercentTestResult],[ProfitLossStatus],[PromissoryNote_Amount],[PromissoryNote_Currency],[PropertyTaxReceivableCodeId],[PurchaseOption],[PurchaseRVIForCapitalLeaseTreatment],[RateCardRate],[RateExpirationDate],[RecalculateInterestonReprice],[RegularPaymentAmount_Amount],[RegularPaymentAmount_Currency],[RemainingEconomicLifeInMonths],[RemarketingResponsibility],[Rent_Amount],[Rent_Currency],[RentAccrualDate],[ResidualValueInsurance_Amount],[ResidualValueInsurance_Currency],[RestructureOnFloatRateChange],[SalesTypeLeaseGrossProfit_Amount],[SalesTypeLeaseGrossProfit_Currency],[SendCCEmailNotificationTo],[SendEmailNotificationTo],[StepPaymentStartDate],[StepPercentage],[StepPeriod],[StubAdjustment],[SupplementalFrequency],[SupplementalFrequencyUnit],[SupplementalGracePeriod],[SupplementalReceivableCodeId],[SupplementalRent_Amount],[SupplementalRent_Currency],[TaxAssetSetupGLTemplateId],[TaxDepDisposalTemplateId],[TaxDepExpenseGLTemplateId],[TennesseeIndebtednessTax_Amount],[TennesseeIndebtednessTax_Currency],[TerminationNoticeEffectiveDate],[TerminationNoticeReceived],[TerminationNoticeReceivedOn],[TermInMonths],[ThirdPartyGuaranteedResidual_Amount],[ThirdPartyGuaranteedResidual_Currency],[TNIndebtednessDiligenzFee_Amount],[TNIndebtednessDiligenzFee_Currency],[TotalDownPayment_Amount],[TotalDownPayment_Currency],[TotalEconomicLifeInMonths],[TotalEconomicLifeTestResult],[TotalStreamTaxAmount_Amount],[TotalStreamTaxAmount_Currency],[TotalUpfrontTaxAmount_Amount],[TotalUpfrontTaxAmount_Currency],[TotalYield],[VATDownPayment_Amount],[VATDownPayment_Currency],[VendorExceptionApprovalNumber],[VendorRateBuyDownAmount_Amount],[VendorRateBuyDownAmount_Currency],[YieldCalculationParametersChanged])
    VALUES (S.[AdvancetoDealer_Amount],S.[AdvancetoDealer_Currency],S.[ApprovalDateSwapRate],S.[ApprovalNumber],S.[BankYieldSpread],S.[BillInterimAsOf],S.[BillOTPForSoftAssets],S.[BookedResidual_Amount],S.[BookedResidual_Currency],S.[CapitalizedSalesTaxPayment_Amount],S.[CapitalizedSalesTaxPayment_Currency],S.[CapitalizeUpfrontSalesTax],S.[CashGuaranteesAmount_Amount],S.[CashGuaranteesAmount_Currency],S.[ClassificationContractType],S.[ClassificationOverriddenById],S.[ClassificationYield],S.[ClassificationYield5A],S.[ClassificationYield5B],S.[CommencementDate],S.[CompoundingFrequency],S.[CostOfFunds],S.[CreatedById],S.[CreatedTime],S.[CreateInvoiceForAdvanceRental],S.[CreateSoftAssetsForCappedSalesTax],S.[CreateSoftAssetsForInterimInterest],S.[CreateSoftAssetsForInterimRent],S.[CustomerExpectedResidual_Amount],S.[CustomerExpectedResidual_Currency],S.[CustomerFacingYield],S.[CustomerGuaranteedResidual_Amount],S.[CustomerGuaranteedResidual_Currency],S.[CustomerNotificationLeadDays],S.[CustomerTermInMonths],S.[DateOfIncorporation],S.[DayCountConvention],S.[DeferredSellingProfit_Amount],S.[DeferredSellingProfit_Currency],S.[DeferredTaxBalance_Amount],S.[DeferredTaxBalance_Currency],S.[DeferredTaxGLTemplateId],S.[DeliverViaEmail],S.[DeliverViaMail],S.[DownPayment_Amount],S.[DownPayment_Currency],S.[DownPaymentDueDate],S.[DownPaymentPercentageId],S.[DueDay],S.[EffectiveAnnualRate],S.[EligibleForResidualValueInsurance],S.[ExpirationDate],S.[FinancedAmountExclVAT_Amount],S.[FinancedAmountExclVAT_Currency],S.[FixedTermReceivableCodeId],S.[FloatIncomeGLTemplateId],S.[FloatRateARReceivableCodeId],S.[FloridaStampTax_Amount],S.[FloridaStampTax_Currency],S.[FMV_Amount],S.[FMV_Currency],S.[FollowUpLeadDays],S.[FrequencyStartDate],S.[GLJournalId],S.[Id],S.[InceptionPayment_Amount],S.[InceptionPayment_Currency],S.[InterimAssessmentMethod],S.[InterimInterestBillingType],S.[InterimInterestDayCountConvention],S.[InterimInterestFrequencyStartDate],S.[InterimInterestIncomeGLTemplateId],S.[InterimInterestReceivableCodeId],S.[InterimPaymentFrequency],S.[InterimPaymentFrequencyDays],S.[InterimRent_Amount],S.[InterimRent_Currency],S.[InterimRentBillingType],S.[InterimRentDayCountConvention],S.[InterimRentFrequencyStartDate],S.[InterimRentIncomeGLTemplateId],S.[InterimRentPayableCodeId],S.[InterimRentPayableWithholdingTaxRate],S.[InterimRentReceivableCodeId],S.[InternalYield],S.[InvestmentModifiedAfterPayment],S.[InvestmentModifiedAfterPaymentForSpecificCostAdj],S.[InvestorNotificationLeadDays],S.[IsAdvance],S.[IsApplicable],S.[IsBargainPurchaseOption],S.[IsBuybackGuaranteebyVendor],S.[IsCalculationDoneAsOfSalesType],S.[IsClassificationTestDone],S.[IsClassificationYield5AExtreme],S.[IsClassificationYield5BExtreme],S.[IsClassificationYieldExtreme],S.[IsDownpaymentIncludesTax],S.[IsFloatRateLease],S.[IsInterimRentInAdvance],S.[IsInternalYieldExtreme],S.[IsLesseeNotice],S.[IsLessorNotice],S.[IsLessorYieldExtreme],S.[IsLessorYieldFinanceAssetExtreme],S.[IsLessorYieldLeaseAssetExtreme],S.[IsManagementYieldComputed],S.[IsManagementYieldExtreme],S.[IsOTPParametersChanged],S.[IsOTPRegularPaymentStream],S.[IsOTPScheduled],S.[IsOverTermLease],S.[IsPricingYieldExtreme],S.[IsPromissoryNote],S.[IsRegularPaymentStream],S.[IsReleased],S.[IsSpecializedUseAssets],S.[IsStepPayment],S.[IsSupplementalAdvance],S.[IsTaxLease],S.[IsTotalYieldExtreme],S.[IsTransferOfOwnership],S.[IsYieldComputed],S.[LastExtensionARUpdateRunDate],S.[LastSupplementalARUpdateRunDate],S.[LeaseBookingGLTemplateId],S.[LeaseContractType],S.[LeaseIncomeGLTemplateId],S.[LessorNoticePeriod],S.[LessorYield],S.[LessorYieldFinanceAsset],S.[LessorYieldLeaseAsset],S.[ManagementYield],S.[Markup_Amount],S.[Markup_Currency],S.[MaturityDate],S.[MaturityDateBasis],S.[MaturityPayment_Amount],S.[MaturityPayment_Currency],S.[MaxNoticePeriod],S.[MinNoticePeriod],S.[NetInvestment_Amount],S.[NetInvestment_Currency],S.[NetTermBasis],S.[NetTerms],S.[NinetyPercent5ATestResult],S.[NinetyPercent5ATestResultPassed],S.[NinetyPercent5BTestResult],S.[NinetyPercent5BTestResultPassed],S.[NinetyPercentTestPresentValue_Amount],S.[NinetyPercentTestPresentValue_Currency],S.[NinetyPercentTestPresentValue5A_Amount],S.[NinetyPercentTestPresentValue5A_Currency],S.[NinetyPercentTestPresentValue5B_Amount],S.[NinetyPercentTestPresentValue5B_Currency],S.[NinetyPercentTestResult],S.[NinetyPercentTestResultPassed],S.[NoticeBasis],S.[NumberOfInceptionPayments],S.[NumberOfOverTermPayments],S.[NumberOfPayments],S.[OfferLetterAdditionalDays],S.[OTPIncomeGLTemplateId],S.[OTPPaymentFrequency],S.[OTPPaymentFrequencyUnit],S.[OTPReceivableCodeId],S.[OTPRent_Amount],S.[OTPRent_Currency],S.[OTPRentPayableCodeId],S.[OTPRentPayableWithholdingTaxRate],S.[OTPRentPreference],S.[OTPSharingTemplateId],S.[OverrideReason],S.[PaymentFrequency],S.[PaymentFrequencyDays],S.[PercentageToVendor],S.[PostDate],S.[PreRVINinetyPercentTestPresentValue_Amount],S.[PreRVINinetyPercentTestPresentValue_Currency],S.[PreRVINinetyPercentTestResult],S.[ProfitLossStatus],S.[PromissoryNote_Amount],S.[PromissoryNote_Currency],S.[PropertyTaxReceivableCodeId],S.[PurchaseOption],S.[PurchaseRVIForCapitalLeaseTreatment],S.[RateCardRate],S.[RateExpirationDate],S.[RecalculateInterestonReprice],S.[RegularPaymentAmount_Amount],S.[RegularPaymentAmount_Currency],S.[RemainingEconomicLifeInMonths],S.[RemarketingResponsibility],S.[Rent_Amount],S.[Rent_Currency],S.[RentAccrualDate],S.[ResidualValueInsurance_Amount],S.[ResidualValueInsurance_Currency],S.[RestructureOnFloatRateChange],S.[SalesTypeLeaseGrossProfit_Amount],S.[SalesTypeLeaseGrossProfit_Currency],S.[SendCCEmailNotificationTo],S.[SendEmailNotificationTo],S.[StepPaymentStartDate],S.[StepPercentage],S.[StepPeriod],S.[StubAdjustment],S.[SupplementalFrequency],S.[SupplementalFrequencyUnit],S.[SupplementalGracePeriod],S.[SupplementalReceivableCodeId],S.[SupplementalRent_Amount],S.[SupplementalRent_Currency],S.[TaxAssetSetupGLTemplateId],S.[TaxDepDisposalTemplateId],S.[TaxDepExpenseGLTemplateId],S.[TennesseeIndebtednessTax_Amount],S.[TennesseeIndebtednessTax_Currency],S.[TerminationNoticeEffectiveDate],S.[TerminationNoticeReceived],S.[TerminationNoticeReceivedOn],S.[TermInMonths],S.[ThirdPartyGuaranteedResidual_Amount],S.[ThirdPartyGuaranteedResidual_Currency],S.[TNIndebtednessDiligenzFee_Amount],S.[TNIndebtednessDiligenzFee_Currency],S.[TotalDownPayment_Amount],S.[TotalDownPayment_Currency],S.[TotalEconomicLifeInMonths],S.[TotalEconomicLifeTestResult],S.[TotalStreamTaxAmount_Amount],S.[TotalStreamTaxAmount_Currency],S.[TotalUpfrontTaxAmount_Amount],S.[TotalUpfrontTaxAmount_Currency],S.[TotalYield],S.[VATDownPayment_Amount],S.[VATDownPayment_Currency],S.[VendorExceptionApprovalNumber],S.[VendorRateBuyDownAmount_Amount],S.[VendorRateBuyDownAmount_Currency],S.[YieldCalculationParametersChanged])

OUTPUT $action, Inserted.Id, S.Token, Inserted.[RowVersion], Deleted.[RowVersion]
INTO @Output;

SELECT o.Id, o.Token, o.[RowVersion], CASE WHEN s.[RowVersion] <> o.[OldRowVersion] THEN 1 ELSE 0 END as ErrorCode FROM @Output o join @val s on o.Token = s.Token AND [Action] = 'UPDATE'
UNION ALL
SELECT Id, Token, [RowVersion], 0 as ErrorCode FROM @Output WHERE [Action] = 'INSERT';

GO
